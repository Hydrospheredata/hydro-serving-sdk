

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Getting Started Tutorial &mdash; hydrosdk 3.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.svg"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="hydrosdk API" href="hydrosdk/hydrosdk.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #178CF2" >
          

          
            <a href="index.html" class="icon icon-home"> hydrosdk
          

          
            
            <img src="_static/logo_white.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whats_new.html">What’s new in 3.0.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#using-hydrosdk">Using hydrosdk</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-modelversion">Creating a ModelVersion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connect-to-your-deployed-model">Connect to your deployed model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#attach-monitoring-model-to-your-inference-model">Attach monitoring model to your inference model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hydrosdk/hydrosdk.html">hydrosdk API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hydrosdk/hydrosdk.cluster.html">hydrosdk.cluster module</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrosdk/hydrosdk.application.html">hydrosdk.application module</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrosdk/hydrosdk.modelversion.html">hydrosdk.modelversion module</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrosdk/hydrosdk.predictor.html">hydrosdk.predictor module</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrosdk/hydrosdk.deployment_configuration.html">hydrosdk.deployment_configuration module</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrosdk/hydrosdk.signature.html">hydrosdk.signature module</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrosdk/hydrosdk.exceptions.html">hydrosdk.exceptions module</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrosdk/hydrosdk.image.html">hydrosdk.image module</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrosdk/hydrosdk.monitoring.html">hydrosdk.monitoring module</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrosdk/hydrosdk.servable.html">hydrosdk.servable module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="getting_help.html">Getting Help</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Hydrospheredata/hydro-serving-sdk">hydrosdk Github page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/hydrosdk/">hydrosdk PyPi package</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Hydrospheredata/hydro-serving">Hydrosphere Platform Github page</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hydrosdk</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Getting Started Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/getting_started_tutorial.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started-tutorial">
<h1>Getting Started Tutorial<a class="headerlink" href="#getting-started-tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will show you how to use hydrosdk. You will learn how to upload your code as a model to Hydrosphere.io,
setup your client code to make inference, and attach a monitoring metric to your model.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This tutorials was written for hydrosdk==$sdk_version</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you haven’t launched Hydrosphere.io platform, please do so before proceeding with this tutorial.
You can learn how to do by checking documentation here - <a class="reference external" href="https://hydrosphere.io/serving-docs/latest/install/index.html">https://hydrosphere.io/serving-docs/latest/install/index.html</a>.</p>
</div>
<div class="section" id="creating-a-modelversion">
<h2>Creating a ModelVersion<a class="headerlink" href="#creating-a-modelversion" title="Permalink to this headline">¶</a></h2>
<p>First we need to connect to the Hydrosphere.io platform by creating <a class="reference internal" href="hydrosdk/hydrosdk.cluster.html"><span class="doc">Cluster</span></a> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hydrosdk.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>
<span class="kn">from</span> <span class="nn">grpc</span> <span class="kn">import</span> <span class="n">ssl_channel_credentials</span>

<span class="c1"># This cluster instance uses both - HTTP and GRPC APIs. Latter is used only for sending data to a deployed model</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="s2">&quot;http-cluster-address&quot;</span><span class="p">,</span>
                 <span class="n">grpc_address</span><span class="o">=</span><span class="s2">&quot;grpc-cluster-address&quot;</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">grpc_credentials</span><span class="o">=</span><span class="n">ssl_channel_credentials</span><span class="p">())</span>
</pre></div>
</div>
<p>Next we need to write the script which will be uploaded to the Hydrosphere platform.
For the simplicity of this tutorial let’s imagine that our model will be calculating
square root of a double value provided.</p>
<p>We’ll call this script ‘func_main.py’ and put it in “model/src/func_main.py”.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">model/src/func_main.py</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="k">def</span> <span class="nf">infer</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="linenos">4</span>   <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<p>Our file structure at this point should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
└── model
    └── src
        └── func_main.py
</pre></div>
</div>
<p>To let hydrosdk know which files needs to be uploaded to the Hydrosphere.io platform we will capture all
necessary file paths in a <code class="docutils literal notranslate"><span class="pre">payload</span></code>. We can also specify a common prefix to all paths in a <code class="docutils literal notranslate"><span class="pre">payload</span></code> in a <code class="docutils literal notranslate"><span class="pre">path</span></code> argument.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;model/&quot;</span>
<span class="n">payload</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;src/func_main.py&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Hydrosphere Serving has a strictly typed inference engine, so before uploading our model we need to specify it’s signature with
<code class="docutils literal notranslate"><span class="pre">SignatureBuilder</span></code>. Signature contains information about which method inside your <code class="docutils literal notranslate"><span class="pre">func_main.py</span></code> should be called,
as well as what its inputs and outputs shapes and types are.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hydrosdk.signature</span> <span class="kn">import</span> <span class="n">SignatureBuilder</span>

<span class="n">signature</span> <span class="o">=</span> <span class="n">SignatureBuilder</span><span class="p">(</span><span class="s1">&#39;infer&#39;</span><span class="p">)</span> \
                <span class="o">.</span><span class="n">with_input</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span> <span class="s2">&quot;scalar&quot;</span><span class="p">)</span> \
                <span class="o">.</span><span class="n">with_output</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span> <span class="s2">&quot;scalar&quot;</span><span class="p">)</span> \
                <span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>At this point we can combine all our efforts into the <a class="reference internal" href="hydrosdk/hydrosdk.modelversion.html"><span class="doc">ModelVersion</span></a> object using <a class="reference internal" href="hydrosdk/hydrosdk.modelversion.html"><span class="doc">ModelVersionBuilder</span></a>. We’ll call this model <code class="docutils literal notranslate"><span class="pre">&quot;sqrt_model&quot;</span></code>.</p>
<p>Moreover, we need to specify environment in which our model will run.
Such environments are called Runtimes. You can learn more about them <a class="reference external" href="https://docs.hydrosphere.io/about/concepts#runtimes">here</a>.
In this tutorial we will use default Python 3.7 runtime.
This runtime uses <code class="docutils literal notranslate"><span class="pre">src/func_main.py</span></code> script as an entry point, that’s why we organised our files as we did.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hydrosdk.modelversion</span> <span class="kn">import</span> <span class="n">ModelVersionBuilder</span>
<span class="kn">from</span> <span class="nn">hydrosdk.image</span> <span class="kn">import</span> <span class="n">DockerImage</span>

<span class="n">sqrt_local_model_builder</span> <span class="o">=</span> <span class="n">ModelVersionBuilder</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;sqrt_model&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">with_runtime</span><span class="p">(</span><span class="n">DockerImage</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;hydrosphere/serving-runtime-python-$runtime_version&quot;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;$runtime_tag&quot;</span><span class="p">))</span> \
    <span class="o">.</span><span class="n">with_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">with_signature</span><span class="p">(</span><span class="n">signature</span><span class="p">)</span>
</pre></div>
</div>
<p>After packing all necessary information into a <a class="reference internal" href="hydrosdk/hydrosdk.modelversion.html"><span class="doc">ModelVersionBuilder</span></a>, we finally can build and upload it to the cluster.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sqrt_model</span><span class="p">:</span> <span class="n">ModelVersion</span> <span class="o">=</span> <span class="n">sqrt_local_model_builder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
<span class="n">sqrt_model</span><span class="o">.</span><span class="n">lock_till_released</span><span class="p">()</span>
</pre></div>
</div>
<p>We are finished with uploading our model. Now we can get to the part where we develop a client code for our model.</p>
</div>
<div class="section" id="connect-to-your-deployed-model">
<h2>Connect to your deployed model<a class="headerlink" href="#connect-to-your-deployed-model" title="Permalink to this headline">¶</a></h2>
<p>We have uploaded our model - it’s stored and versioned, but it’s not running yet - we need to deploy it. To deploy a model
you should create an Application - linear pipeline of ModelVersions with monitoring and other benefits.
You can learn more about Applications <a class="reference external" href="https://hydrosphere.io/serving-docs/latest/overview/concepts.html#applications">here</a>.</p>
<p>To create a simple application with one stage we’ll use <a class="reference internal" href="hydrosdk/hydrosdk.application.html"><span class="doc">ApplicationBuilder</span></a> along with <a class="reference internal" href="hydrosdk/hydrosdk.application.html"><span class="doc">ExecutionStageBuilder</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hydrosdk.application</span> <span class="kn">import</span> <span class="n">ApplicationBuilder</span><span class="p">,</span> <span class="n">ExecutionStageBuilder</span>

<span class="n">stage</span> <span class="o">=</span> <span class="n">ExecutionStageBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">with_model_variant</span><span class="p">(</span><span class="n">model_version</span><span class="o">=</span><span class="n">sqrt_model</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">app_builder</span> <span class="o">=</span> <span class="n">ApplicationBuilder</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;sqrt_model&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">with_stage</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>
<span class="n">sqrt_app</span> <span class="o">=</span> <span class="n">app_builder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
<span class="n">sqrt_app</span><span class="o">.</span><span class="n">lock_while_starting</span><span class="p">()</span>
</pre></div>
</div>
<p>Applications provide <a class="reference internal" href="hydrosdk/hydrosdk.predictor.html"><span class="doc">Predictor</span></a> objects, which should be used for data inference.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictor</span> <span class="o">=</span> <span class="n">sqrt_app</span><span class="o">.</span><span class="n">predictor</span><span class="p">()</span>
</pre></div>
</div>
<p>Predictors provide <code class="docutils literal notranslate"><span class="pre">predict</span></code> method which we can use to send our data to the model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">predict</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()})</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we have finished with testing our model and can safely delete the application:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hydrosdk.application</span> <span class="kn">import</span> <span class="n">Application</span>

<span class="n">Application</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">app_sqrt</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>In the next section we’ll attach a monitoring model to this model to monitor
quality of our incoming data to prevent “thrash-in thrash out” situation.</p>
</div>
<div class="section" id="attach-monitoring-model-to-your-inference-model">
<h2>Attach monitoring model to your inference model<a class="headerlink" href="#attach-monitoring-model-to-your-inference-model" title="Permalink to this headline">¶</a></h2>
<p>We’ll create a dummy monitoring model to check inputs from our previous model.
Similarly, we define another <code class="docutils literal notranslate"><span class="pre">func_main.py</span></code> and put it in “monitoring_model/src/monitoring_main.py”.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">monitoring_model/src/func_main.py</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="linenos">2</span>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<p>So our file structure will look like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
└── model
    └── src
        └── func_main.py
└── monitoring_model
    └── src
        └── func_main.py
</pre></div>
</div>
<p>And our payload is</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">payload</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;src/func_main.py&#39;</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;monitoring_model/&quot;</span>
</pre></div>
</div>
<p>To attach one model as a metric to another model it’s signature should combine both input and output of monitored model
with a single float scalar value in the output.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">signature</span> <span class="o">=</span> <span class="n">SignatureBuilder</span><span class="p">(</span><span class="s1">&#39;predict&#39;</span><span class="p">)</span> \
               <span class="o">.</span><span class="n">with_input</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span> <span class="s2">&quot;scalar&quot;</span><span class="p">)</span> \
               <span class="o">.</span><span class="n">with_input</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span> <span class="s2">&quot;scalar&quot;</span><span class="p">)</span> \
               <span class="o">.</span><span class="n">with_output</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s2">&quot;scalar&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>Similarly we create a ModelVersion using ModelVersionBuilder and upload it to the cluster.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">monitoring_local_model_builder</span> <span class="o">=</span> <span class="n">ModelVersionBuilder</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;sqrt_monitoring_model&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">with_runtime</span><span class="p">(</span><span class="n">DockerImage</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;hydrosphere/serving-runtime-python-$runtime_version&quot;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;$runtime_tag&quot;</span><span class="p">))</span> \
    <span class="o">.</span><span class="n">with_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">with_signature</span><span class="p">(</span><span class="n">signature</span><span class="p">)</span>

<span class="n">monitoring_model</span> <span class="o">=</span> <span class="n">monitoring_local_model_builder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
<span class="n">monitoring_model</span><span class="o">.</span><span class="n">lock_till_released</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally we attach this freshly uploaded model to our first one. To attach model as a metric to another model we need to:</p>
<ol class="simple">
<li><p>Create metric configuration as a MetricSpecConfig object. In a configuration we specify id of monitoring model,
threshold and comparison operator to compare output of monitoring model with threshold. Model considered healthy if comparison
is <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Create new metric by calling <code class="docutils literal notranslate"><span class="pre">MetricSpec.create</span></code> and providing id of monitored model with metric config.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hydrosdk.monitoring</span> <span class="kn">import</span> <span class="n">ThresholdCmpOp</span>

<span class="n">metric</span> <span class="o">=</span> <span class="n">monitoring_model</span><span class="o">.</span><span class="n">as_metric</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ThresholdCmpOp</span><span class="o">.</span><span class="n">NOT_EQ</span><span class="p">)</span>
<span class="n">sqrt_model</span><span class="o">.</span><span class="n">assign_metrics</span><span class="p">([</span><span class="n">metric</span><span class="p">])</span>
</pre></div>
</div>
<p>We have attached monitoring model to our previously uploaded model to check input data.
All the future data we send through <code class="docutils literal notranslate"><span class="pre">sqrt_model</span></code>, together with results of inference is shadowed through all monitoring metrics.
You can explore how metrics behave in the web interface.</p>
<p>To simulate data we can again deploy an application and send some data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sqrt_app</span> <span class="o">=</span> <span class="n">app_builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">sqrt_app</span><span class="o">.</span><span class="n">lock_while_starting</span><span class="p">()</span>

<span class="n">predictor</span> <span class="o">=</span> <span class="n">sqrt_app</span><span class="o">.</span><span class="n">predictor</span><span class="p">()</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">predict</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()})</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="n">Application</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">sqrt_app</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>You can explore changes on the UI.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="hydrosdk/hydrosdk.html" class="btn btn-neutral float-right" title="hydrosdk API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quickstart" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Hydrosphere.io.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-160853646-4', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>